# Figma Variables Downloader

Figmaドキュメント内の変数（Variables）をJSON形式でダウンロードできるプラグインです。

## 🚀 **機能**

### **主要機能**
- **自動スキャン**: プラグイン起動時に自動的に変数をスキャン
- **手動リロード**: 再スキャンボタンで手動で変数を再取得
- **コレクション選択**: 特定のコレクション（Global、Levcli、Refill等）を選択してダウンロード
- **データ形式選択**: Rawデータまたはマッピングデータ（SCSS変数形式）を選択
- **プレビュー機能**: ダウンロード前にデータ内容を確認
- **ワンクリックコピー**: プレビュー内容をクリップボードにコピー

### **データ形式**
- **Rawデータ**: Figmaの変数データをそのまま出力
- **マッピングデータ**: SCSS変数形式に変換（`XXX/YYY/ZZZ` → `$XXX-YYY-ZZZ`）

## 🛠️ **インストール・セットアップ**

### **前提条件**
- Figma Desktop App
- Node.js 16.0以上
- npm または yarn

### **セットアップ手順**
```bash
# リポジトリをクローン
git clone <repository-url>
cd telemedicine-figma-plugin/variables-downloader

# 依存関係をインストール
npm install

# ビルド
npm run build
```

### **Figmaプラグインへの追加**
1. Figma Desktop Appを開く
2. メニューバーから「Plugins」→「Development」→「New Plugin...」を選択
3. 「Import plugin from manifest...」をクリック
4. `manifest.json`ファイルを選択

## 🧪 **テスト方法**

### **基本的なテスト手順**

#### **1. プラグイン起動テスト**
```bash
# ビルド
npm run build

# Figmaでプラグインを起動
# 自動スキャンが開始されることを確認
```

#### **2. 機能テスト**

##### **自動スキャンテスト**
- プラグイン起動時に「変数をスキャン中...」が表示される
- スキャン完了後に変数数が表示される
- コレクション選択UIが表示される

##### **手動リロードテスト**
- 再スキャンボタンをクリック
- スキャンが再実行されることを確認
- ステータスメッセージが更新される

##### **データ形式切り替えテスト**
- 「マッピングデータ」と「生データ」を切り替え
- プレビュー内容が変更されることを確認
- ファイル名が適切に更新される

##### **コレクション選択テスト**
- 各コレクション（All、Global、Levcli等）を選択
- プレビュー内容がフィルタリングされることを確認
- 件数が正しく表示される

##### **ダウンロードテスト**
- ダウンロードボタンをクリック
- JSONファイルが正常にダウンロードされる
- ファイル内容がプレビューと一致する

##### **コピー機能テスト**
- コピーボタンをクリック
- プレビュー内容がクリップボードにコピーされる
- ボタンの状態が「コピー済み」に変化する

### **エラーテスト**

#### **変数が存在しない場合**
- 空のFigmaドキュメントでプラグインを起動
- 適切なエラーメッセージが表示されることを確認

#### **ネットワークエラー**
- オフライン状態でプラグインを起動
- エラーハンドリングが適切に動作することを確認

## 🔧 **開発・デバッグ**

### **開発環境のセットアップ**
```bash
# 開発用ビルド（watch mode）
npm run dev

# 本番用ビルド
npm run build

# 型チェック
npm run type-check
```

### **デバッグ方法**

#### **コンソールログの確認**
1. Figmaプラグインを起動
2. ブラウザの開発者ツール（F12）を開く
3. Consoleタブでログを確認

#### **主要なログメッセージ**
```
Script loaded, readyState: loading
DOM ready: No
DOMContentLoaded event fired
Starting scan...
Variables data received: {...}
Collections data received: {...}
```

### **よくある問題と対処法**

#### **変数が読み込まれない**
- コンソールでエラーログを確認
- `collectionsData is not defined`エラーの場合は変数宣言を確認
- 重複宣言がないかチェック

#### **UIが正しく表示されない**
- CSSクラスが正しく適用されているか確認
- 要素のIDが正しく設定されているか確認
- イベントリスナーが適切に設定されているか確認

## 📁 **ファイル構成**

```
variables-downloader/
├── README.md           # このファイル
├── manifest.json       # Figmaプラグインの設定
├── package.json        # 依存関係とスクリプト
├── tsconfig.json       # TypeScript設定
├── code.ts            # メインスレッド（Figma API）
└── ui.html            # UIスレッド（HTML/CSS/JS）
```

## 🎯 **技術仕様**

### **アーキテクチャ**
- **メインスレッド**: Figma APIとの通信、変数データの取得
- **UIスレッド**: ユーザーインターフェース、データの表示・操作

### **使用技術**
- **TypeScript**: 型安全性の確保
- **Figma Plugin API**: 変数データの取得
- **HTML/CSS/JavaScript**: UIの実装
- **PostMessage**: スレッド間通信

### **データフロー**
1. プラグイン起動 → 自動スキャン開始
2. Figma APIから変数データを取得
3. メインスレッドからUIスレッドにデータ送信
4. UIスレッドでデータを表示・編集
5. ユーザー操作に応じてデータを変換・ダウンロード

## 🤝 **コントリビューション**

### **開発の流れ**
1. Issueを作成して問題や改善点を報告
2. ブランチを作成して開発
3. テストを実行して動作確認
4. プルリクエストを作成
5. コードレビュー後にマージ

### **コーディング規約**
- TypeScriptの型定義を適切に行う
- エラーハンドリングを実装する
- コンソールログでデバッグ情報を出力する
- ユーザビリティを考慮したUI設計

## 📄 **ライセンス**

このプロジェクトは社内利用を目的としています。

## 📞 **サポート**

問題や質問がある場合は、開発チームまでお問い合わせください。

---

**最終更新**: 2024年12月
**バージョン**: 1.0.0
